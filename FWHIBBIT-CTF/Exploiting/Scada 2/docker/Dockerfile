FROM alpine:3.4

RUN apk update && apk add --no-cache \
    supervisor && \
    apk del gcc musl-dev linux-headers libffi-dev augeas-dev python-dev

## Fix libs
RUN ln -s /lib/ /lib64

## Supervisor
ADD conf/supervisord.conf /etc/supervisord.conf

## Copy code
ADD src/ /opt/scada/
RUN chmod 444 /opt/scada/* &&\
    chmod +x /opt/scada/scada

## Start
CMD ["/usr/bin/supervisord","-n","-c","/etc/supervisord.conf"]
