from socket import socket, timeout, AF_INET, SOCK_DGRAM, SO_BROADCAST, SOL_SOCKET
from time import sleep, time
from random import random
import os
import sys

UDP_PORT = 5005 
RESTART_DELAY = 15

print("UDP port:", UDP_PORT)
sys.stdout.flush()

s = socket(AF_INET, SOCK_DGRAM)
s.bind(('', UDP_PORT))
s.setsockopt(SOL_SOCKET, SO_BROADCAST, 1)

def broadcast(msg):
    s.sendto(msg.encode('utf-8'), ('172.30.0.15', UDP_PORT))
    print(msg)
    sys.stdout.flush()


while True:
    sleep(RESTART_DELAY)
    with open('script.txt', 'r') as script:
        for line in script:
            sleep(1)
            broadcast(line)
